<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¤×•×¨×˜×œ × ×™×”×•×œ - ×ª×¤××¨×ª ×¢×•×‘×“×™×”</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; padding: 20px; direction: rtl; }
        .admin-box { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); max-width: 1250px; margin: auto; position: relative; }
        h1 { color: #1a237e; text-align: center; border-bottom: 3px solid #d4af37; padding-bottom: 10px; margin-bottom: 25px; }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #ddd; padding-bottom: 10px; flex-wrap: wrap; }
        .tab-btn { padding: 10px 20px; border: none; background: #e0e0e0; cursor: pointer; border-radius: 8px 8px 0 0; font-weight: bold; transition: 0.3s; }
        .tab-btn.active { background: #1a237e; color: white; border-bottom: 3px solid #d4af37; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .token-section { background: #e8f5e9; border: 1px solid #4caf50; padding: 12px; border-radius: 10px; margin-bottom: 20px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; color: #333; }
        textarea, input[type="text"], input[type="password"], input[type="number"], input[type="date"], select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        
        .msg-container-row { border: 1px solid #ddd; padding: 15px; border-radius: 10px; margin-bottom: 15px; background: #fafafa; }
        .msg-row { display: flex; gap: 10px; align-items: center; margin-top: 10px; }
        .msg-row textarea { flex-grow: 1; height: 60px; }
        .color-picker { width: 50px; height: 60px; border: 1px solid #ccc; border-radius: 8px; cursor: pointer; padding: 2px; }

        button.main-btn { background-color: #1a237e; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; font-size: 16px; margin-top: 10px; transition: background 0.3s; }
        button.main-btn:hover { background-color: #0d1440; }
        
        .logout-btn { background-color: #f44336; padding: 8px 15px; width: auto; font-size: 13px; position: absolute; left: 20px; top: 20px; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        
        .dorm-section { display: flex; gap: 20px; margin-bottom: 30px; align-items: stretch; }
        .rooms-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; flex-grow: 1; }
        .room-box { border: 2px solid #1a237e; border-radius: 8px; background: white; }
        .room-title { background: #1a237e; color: #d4af37; text-align: center; font-size: 14px; padding: 3px; font-weight: bold; }
        .bed-item { border-top: 1px solid #eee; padding: 5px; text-align: center; font-size: 13px; height: 20px; color: #333; white-space: nowrap; overflow: hidden; }
        .summary-box { background: #fffde7; border: 2px solid #fbc02d; padding: 15px; border-radius: 10px; min-width: 150px; text-align: center; }

        .table-container { overflow-x: auto; margin-top: 15px; }
        table { width: 100%; border-collapse: collapse; background: white; font-size: 0.85rem; min-width: 1000px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }
        th { background-color: #1a2a6c; color: #d4af37; position: sticky; top: 0; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        
        .student-form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; background: #f9f9f9; padding: 20px; border-radius: 10px; border: 1px solid #ddd; }
        
        #globalStatus { text-align: center; margin-top: 15px; font-weight: bold; min-height: 24px; }

        .tasks-layout { display: flex; gap: 20px; margin-top: 20px; }
        .tasks-sidebar { width: 250px; background: #fff; border: 2px solid #1a237e; border-radius: 10px; padding: 15px; }
        .tasks-week { flex-grow: 1; display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
        .day-column { background: #e3f2fd; border-radius: 8px; padding: 10px; min-height: 400px; border: 1px solid #bbdefb; }
        .day-header { text-align: center; font-weight: bold; border-bottom: 2px solid #1a237e; margin-bottom: 10px; padding-bottom: 5px; color: #1a237e; }
        .task-card { background: white; border: 1px solid #ddd; padding: 8px; margin-bottom: 8px; border-radius: 5px; cursor: grab; font-size: 13px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; }
        .delete-task { color: red; cursor: pointer; float: left; font-weight: bold; }

        .finance-summary { display: flex; gap: 20px; margin-bottom: 20px; }
        .summary-card { flex: 1; padding: 15px; border-radius: 10px; text-align: center; color: white; font-weight: bold; }
        .bg-blue { background: #1a237e; } .bg-green { background: #2e7d32; } .bg-orange { background: #ef6c00; }
    </style>
</head>
<body>

    <div class="admin-box">
        <button class="logout-btn" onclick="logout()">×™×¦×™××” ×œ×“×£ ×”×‘×™×ª</button>
        <h1>× ×™×”×•×œ ××•×¡×“×•×ª ×ª×¤××¨×ª ×¢×•×‘×“×™×”</h1>

        <div class="token-section">
            <label>××¤×ª×— ×’×™×©×” (GitHub Token):</label>
            <input type="password" id="ghToken" onchange="loadAllData()" placeholder="×”×–×Ÿ ×˜×•×§×Ÿ ×œ×˜×¢×™× ×ª × ×ª×•× ×™×">
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="openTab(event, 'boardTab')">ğŸ“¢ ×¢×“×›×•×Ÿ ×œ×•×—</button>
            <button class="tab-btn" onclick="openTab(event, 'studentsTab')">ğŸ“ ×¨×©×™××ª ×‘×—×•×¨×™×</button>
            <button class="tab-btn" onclick="openTab(event, 'tasksTab')">ğŸ“ ××©×™××•×ª ×©×‘×•×¢×™×•×ª</button>
            <button class="tab-btn" onclick="openTab(event, 'financeTab')">ğŸ’° × ×™×”×•×œ ×›×œ×›×œ×™</button>
            <button class="tab-btn" onclick="openTab(event, 'regTab')">ğŸ“‹ ×¨×™×©×•× ×ª×œ××™×“×™×</button>
            <button class="tab-btn" onclick="openTab(event, 'donorTab')">ğŸ¤ × ×™×”×•×œ ×ª×•×¨××™×</button>
        </div>

        <div id="boardTab" class="tab-content active">
            <div class="msg-container">
                <label style="color: #1a237e;">×¤×¨× ×¡×™ ×”×™×©×™×‘×”:</label>
                <div class="input-group"><label>×¤×¨× ×¡ ×”×™×•×:</label><input type="text" id="patronDayInput"></div>
                <div class="input-group"><label>×¤×¨× ×¡ ×”×©×‘×•×¢:</label><input type="text" id="patronWeekInput"></div>
                <div class="input-group"><label>×¤×¨× ×¡ ×”×—×•×“×©:</label><input type="text" id="patronMonthInput"></div>
            </div>
            
            <label style="color: #1a237e;">5 ×”×•×“×¢×•×ª ××ª×—×œ×¤×•×ª (× ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×›×•×ª×¨×ª ×œ×›×œ ×”×•×“×¢×”):</label>
            <div id="messages-list">
                <div class="msg-container-row">
                    <input type="text" id="title1" placeholder="×›×•×ª×¨×ª ×œ×”×•×“×¢×” 1 (×œ××©×œ: ×œ×¢×™×œ×•×™ × ×©××ª)">
                    <div class="msg-row"><textarea id="msg1" placeholder="×ª×•×›×Ÿ ×”×”×•×“×¢×”"></textarea><input type="color" id="clr1" class="color-picker" value="#001f3f"></div>
                </div>
                <div class="msg-container-row">
                    <input type="text" id="title2" placeholder="×›×•×ª×¨×ª ×œ×”×•×“×¢×” 2">
                    <div class="msg-row"><textarea id="msg2" placeholder="×ª×•×›×Ÿ ×”×”×•×“×¢×”"></textarea><input type="color" id="clr2" class="color-picker" value="#001f3f"></div>
                </div>
                <div class="msg-container-row">
                    <input type="text" id="title3" placeholder="×›×•×ª×¨×ª ×œ×”×•×“×¢×” 3">
                    <div class="msg-row"><textarea id="msg3" placeholder="×ª×•×›×Ÿ ×”×”×•×“×¢×”"></textarea><input type="color" id="clr3" class="color-picker" value="#001f3f"></div>
                </div>
                <div class="msg-container-row">
                    <input type="text" id="title4" placeholder="×›×•×ª×¨×ª ×œ×”×•×“×¢×” 4">
                    <div class="msg-row"><textarea id="msg4" placeholder="×ª×•×›×Ÿ ×”×”×•×“×¢×”"></textarea><input type="color" id="clr4" class="color-picker" value="#001f3f"></div>
                </div>
                <div class="msg-container-row">
                    <input type="text" id="title5" placeholder="×›×•×ª×¨×ª ×œ×”×•×“×¢×” 5">
                    <div class="msg-row"><textarea id="msg5" placeholder="×ª×•×›×Ÿ ×”×”×•×“×¢×”"></textarea><input type="color" id="clr5" class="color-picker" value="#001f3f"></div>
                </div>
            </div>

            <div class="input-group">
                <label style="color: #1a237e;">×–×× ×™ ×ª×¤×™×œ×•×ª:</label>
                <textarea id="prayersInput" style="height: 100px;"></textarea>
            </div>
            <button class="main-btn" onclick="updateBoard()">×¢×“×›×Ÿ ×œ×•×— ××•×“×¢×•×ª ×¢×›×©×™×• ğŸš€</button>
        </div>

        <div id="tasksTab" class="tab-content">
            <div style="background: #e8eaf6; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                <label>×”×•×¡×¤×ª ××©×™××” ×—×“×©×” ×œ×××’×¨:</label>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="newTaskInput" placeholder="××” ×¦×¨×™×š ×œ×¢×©×•×ª?">
                    <button onclick="addTask()" style="background:#1a237e; color:white; border:none; padding:0 20px; border-radius:8px; cursor:pointer;">×”×•×¡×£</button>
                </div>
            </div>
            <div class="tasks-layout">
                <div class="tasks-week" id="weekGrid">
                    <div class="day-column" ondrop="drop(event, '×¨××©×•×Ÿ')" ondragover="allowDrop(event)"><div class="day-header">×¨××©×•×Ÿ</div><div id="day-×¨××©×•×Ÿ"></div></div>
                    <div class="day-column" ondrop="drop(event, '×©× ×™')" ondragover="allowDrop(event)"><div class="day-header">×©× ×™</div><div id="day-×©× ×™"></div></div>
                    <div class="day-column" ondrop="drop(event, '×©×œ×™×©×™')" ondragover="allowDrop(event)"><div class="day-header">×©×œ×™×©×™</div><div id="day-×©×œ×™×©×™"></div></div>
                    <div class="day-column" ondrop="drop(event, '×¨×‘×™×¢×™')" ondragover="allowDrop(event)"><div class="day-header">×¨×‘×™×¢×™</div><div id="day-×¨×‘×™×¢×™"></div></div>
                    <div class="day-column" ondrop="drop(event, '×—××™×©×™')" ondragover="allowDrop(event)"><div class="day-header">×—××™×©×™</div><div id="day-×—××™×©×™"></div></div>
                    <div class="day-column" ondrop="drop(event, '×©×™×©×™')" ondragover="allowDrop(event)"><div class="day-header">×©×™×©×™</div><div id="day-×©×™×©×™"></div></div>
                    <div class="day-column" ondrop="drop(event, '××•×¦××™ ×©×‘×ª')" ondragover="allowDrop(event)"><div class="day-header">××•×¦"×©</div><div id="day-××•×¦××™ ×©×‘×ª"></div></div>
                </div>
                <div class="tasks-sidebar" ondrop="drop(event, 'unassigned')" ondragover="allowDrop(event)">
                    <h3 style="margin-top:0; text-align:center; color:#1a237e;">××©×™××•×ª ×œ×‘×™×¦×•×¢</h3>
                    <div id="unassigned-tasks" style="min-height: 350px;"></div>
                </div>
            </div>
            <button class="main-btn" onclick="saveTasksToGH()">×©××•×¨ ×¡×™×“×•×¨ ××©×™××•×ª ×©×‘×•×¢×™ âœ…</button>
        </div>

        <div id="studentsTab" class="tab-content">
            <h3>ğŸ›ï¸ ××¦×‘ ×¤× ×™××™×™×” ×•×—×“×¨×™×</h3>
            <div class="dorm-section">
                <div class="rooms-grid" id="roomsDisplay"></div>
                <div class="summary-box">
                    <strong>×¡×™×›×•× ×—×“×¨×™×</strong><br><br>
                    ×¡×”"×› ××™×˜×•×ª: 28<br>
                    ×ª×¤×•×¡×•×ª: <span id="occCount">0</span><br>
                    <span style="color:green">×¤× ×•×™×•×ª: <span id="freeCount">28</span></span>
                </div>
            </div>
            <h3 id="formTitle">ğŸ“ ×”×•×¡×¤×ª / ×¢×¨×™×›×ª ×‘×—×•×¨</h3>
            <div class="student-form-grid" id="studentForm">
                <input type="hidden" id="editIndex" value="-1">
                <input type="text" id="stFirstName" placeholder="×©× ×¤×¨×˜×™">
                <input type="text" id="stLastName" placeholder="×©× ××©×¤×—×”">
                <input type="text" id="stID" placeholder="×ª×¢×•×“×ª ×–×”×•×ª">
                <input type="text" id="stPhone" placeholder="×˜×œ×¤×•×Ÿ">
                <input type="text" id="stAddress" placeholder="×›×ª×•×‘×ª ××’×•×¨×™×">
                <input type="text" id="stHebDate" placeholder="×ª××¨×™×š ×œ×™×“×” ×¢×‘×¨×™">
                <input type="date" id="stEngDate">
                <input type="number" id="stPayment" placeholder="×ª×©×œ×•× ×œ×™×©×™×‘×”">
                <input type="number" id="stRoom" placeholder="××¡' ×—×“×¨ (1-7)" min="1" max="7">
                <button class="main-btn" style="margin-top:0; background:#4caf50;" onclick="addOrUpdateStudent()" id="submitBtn">×”×•×¡×£ ×ª×œ××™×“</button>
            </div>
            <h3>×¨×©×™××ª ×‘×—×•×¨×™ ×”×™×©×™×‘×”</h3>
            <div class="table-container"><table><thead><tr><th>×©× ××œ×</th><th>×—×“×¨</th><th>×ª"×–</th><th>×˜×œ×¤×•×Ÿ</th><th>×›×ª×•×‘×ª</th><th>×œ×™×“×” ×¢×‘×¨×™</th><th>×œ×™×“×” ×œ×•×¢×–×™</th><th>×ª×©×œ×•×</th><th>×¤×¢×•×œ×”</th></tr></thead><tbody id="students-list"></tbody></table></div>
            <button class="main-btn" onclick="saveStudentsToGH()">×©××•×¨ ×¨×©×™××ª ×‘×—×•×¨×™× ×•×—×“×¨×™× ×œ×¦××™×ª×•×ª</button>
        </div>

        <div id="financeTab" class="tab-content">
            <div class="finance-summary">
                <div class="summary-card bg-blue">×¡×”"×› ×”×•×¦××•×ª: <span id="totalExp">0</span> â‚ª</div>
                <div class="summary-card bg-green">×§×‘×•×¢×•×ª: <span id="fixedExp">0</span> â‚ª</div>
                <div class="summary-card bg-orange">××©×ª× ×•×ª: <span id="varExp">0</span> â‚ª</div>
            </div>
            <div style="background: #f9f9f9; padding: 20px; border-radius: 10px; border: 1px solid #ddd;">
                <h3>×”×–× ×ª ×”×•×¦××” ×—×“×©×”</h3>
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 10px;">
                    <input type="text" id="expDesc" placeholder="×ª×™××•×¨ (×—×©××œ, ××•×›×œ...)">
                    <input type="number" id="expAmount" placeholder="×¡×›×•×">
                    <select id="expType"><option value="×§×‘×•×¢">×§×‘×•×¢</option><option value="××©×ª× ×”">××©×ª× ×”</option></select>
                    <button onclick="addExpense()" style="background:#4caf50; color:white; border:none; border-radius:8px; cursor:pointer;">×”×•×¡×£</button>
                </div>
            </div>
            <div class="table-container"><table><thead><tr><th>×ª×™××•×¨</th><th>×¡×›×•×</th><th>×¡×•×’</th><th>×¤×¢×•×œ×”</th></tr></thead><tbody id="expense-list"></tbody></table></div>
            <button class="main-btn" onclick="saveFinanceToGH()">×©××•×¨ × ×ª×•× ×™× ×›×¡×¤×™×™× ×œ×¦××™×ª×•×ª ğŸ’¾</button>
        </div>

        <div id="regTab" class="tab-content">
            <h3>ğŸ“‹ × ×¨×©××™× ×—×“×©×™× (××”××ª×¨)</h3>
            <div class="table-container"><table><thead><tr><th>×ª××¨×™×š</th><th>×©× ××œ×</th><th>×˜×œ×¤×•×Ÿ</th><th>×¡×˜×˜×•×¡</th><th>×™×©×™×‘×” ×§×•×“××ª</th><th>××¦×‘ ×¨×•×—× ×™</th><th>×¤×¨×˜×™×</th></tr></thead><tbody id="registrations-list"></tbody></table></div>
        </div>

        <div id="donorTab" class="tab-content">
            <h3>ğŸ¤ × ×™×”×•×œ ×ª×•×¨××™×</h3>
            <div style="background: #f9f9f9; padding: 15px; border-radius: 10px; border: 1px solid #ddd;">
                <input type="text" id="donorName" placeholder="×©× ×”×ª×•×¨×" style="margin-bottom: 10px;">
                <input type="text" id="donorNote" placeholder="×”×¢×¨×”" style="margin-bottom: 10px;">
                <button class="main-btn" style="background:#4caf50;" onclick="addDonor()">×”×•×¡×£ ×ª×•×¨×</button>
            </div>
            <div class="table-container"><table><thead><tr><th>×©×</th><th>×”×¢×¨×”</th><th>×¤×¢×•×œ×”</th></tr></thead><tbody id="donors-list"></tbody></table></div>
            <button class="main-btn" onclick="saveDonorsToGH()">×©××•×¨ ×ª×•×¨××™×</button>
        </div>

        <div id="globalStatus"></div>
    </div>

    <script>
        let donorsData = [], allRegistrations = [], studentsData = [], tasksData = [], financeData = [];
        const owner = "avielking1994-cloud", repo = "tiferet-ovadia";

        function openTab(evt, tabName) {
            let i, tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) tabcontent[i].classList.remove("active");
            let tablinks = document.getElementsByClassName("tab-btn");
            for (i = 0; i < tablinks.length; i++) tablinks[i].classList.remove("active");
            document.getElementById(tabName).classList.add("active");
            evt.currentTarget.classList.add("active");
        }

        window.onload = function() {
            const savedToken = localStorage.getItem("github_token");
            if (savedToken) { document.getElementById("ghToken").value = savedToken; loadAllData(); }
        };

        function logout() { localStorage.removeItem("github_token"); window.location.href = "index.html"; }

        async function loadAllData() {
            const token = document.getElementById("ghToken").value;
            if (!token) return;
            localStorage.setItem("github_token", token);
            
            fetchFromGH("data.json", (data) => {
                document.getElementById("patronDayInput").value = data.patronDay || "";
                document.getElementById("patronWeekInput").value = data.patronWeek || "";
                document.getElementById("patronMonthInput").value = data.patronMonth || "";
                document.getElementById("prayersInput").value = data.prayers || "";
                if (data.messagesConfig) {
                    data.messagesConfig.forEach((m, i) => { 
                        if (i < 5) { 
                            document.getElementById(`msg${i+1}`).value = m.text || ""; 
                            document.getElementById(`clr${i+1}`).value = m.color || "#001f3f";
                            // ×˜×¢×™× ×ª ×”×›×•×ª×¨×•×ª ×× ×”×Ÿ ×§×™×™××•×ª ×‘×©×¨×ª
                            const titleEl = document.getElementById(`title${i+1}`);
                            if(titleEl) titleEl.value = m.title || "";
                        } 
                    });
                }
            });
            fetchFromGH("registrations.json", (data) => { allRegistrations = data || []; renderRegistrations(); });
            fetchFromGH("donors.json", (data) => { donorsData = data || []; renderDonors(); });
            fetchFromGH("students.json", (data) => { studentsData = data || []; renderStudents(); });
            fetchFromGH("tasks.json", (data) => { tasksData = data || []; renderTasks(); });
            fetchFromGH("finance.json", (data) => { financeData = data || []; renderFinance(); });
        }

        // --- ×¤×•× ×§×¦×™×•×ª ×›×¡×¤×™× ---
        function addExpense() {
            const desc = document.getElementById("expDesc").value, amt = parseFloat(document.getElementById("expAmount").value), type = document.getElementById("expType").value;
            if(!desc || !amt) return alert("××œ× ×ª×™××•×¨ ×•×¡×›×•×");
            financeData.push({ id: Date.now(), desc, amount: amt, type });
            renderFinance(); document.getElementById("expDesc").value = ""; document.getElementById("expAmount").value = "";
        }
        function renderFinance() {
            const list = document.getElementById("expense-list"); let t=0, f=0, v=0;
            list.innerHTML = financeData.map((e, i) => {
                t += e.amount; if(e.type === "×§×‘×•×¢") f += e.amount; else v += e.amount;
                return `<tr><td>${e.desc}</td><td>${e.amount} â‚ª</td><td>${e.type}</td><td><button onclick="financeData.splice(${i},1);renderFinance();" style="background:red;color:white;border:none;padding:5px;border-radius:4px;">××—×§</button></td></tr>`;
            }).join('');
            document.getElementById("totalExp").innerText = t; document.getElementById("fixedExp").innerText = f; document.getElementById("varExp").innerText = v;
        }
        async function saveFinanceToGH() { await saveToGH("finance.json", financeData, "Update Finance"); }

        // --- ××©×™××•×ª ---
        function addTask() {
            const input = document.getElementById("newTaskInput"); if (!input.value) return;
            tasksData.push({ id: Date.now(), text: input.value, day: 'unassigned' }); input.value = ""; renderTasks();
        }
        function renderTasks() {
            const unassignedList = document.getElementById("unassigned-tasks"); const days = ['×¨××©×•×Ÿ', '×©× ×™', '×©×œ×™×©×™', '×¨×‘×™×¢×™', '×—××™×©×™', '×©×™×©×™', '××•×¦××™ ×©×‘×ª'];
            unassignedList.innerHTML = ""; days.forEach(d => { if(document.getElementById(`day-${d}`)) document.getElementById(`day-${d}`).innerHTML = ""; });
            tasksData.forEach(t => {
                const taskEl = document.createElement("div"); taskEl.className = "task-card"; taskEl.draggable = true;
                taskEl.innerHTML = `<span class="delete-task" onclick="removeTask(${t.id})">Ã—</span> ${t.text}`;
                taskEl.ondragstart = (e) => e.dataTransfer.setData("taskId", t.id);
                if (t.day === 'unassigned') unassignedList.appendChild(taskEl);
                else { const dayBox = document.getElementById(`day-${t.day}`); if (dayBox) dayBox.appendChild(taskEl); }
            });
        }
        function allowDrop(ev) { ev.preventDefault(); }
        function drop(ev, day) { ev.preventDefault(); const taskId = ev.dataTransfer.getData("taskId"); const task = tasksData.find(t => t.id == taskId); if (task) { task.day = day; renderTasks(); } }
        function removeTask(id) { tasksData = tasksData.filter(t => t.id != id); renderTasks(); }
        async function saveTasksToGH() { await saveToGH("tasks.json", tasksData, "Update Tasks Schedule"); }

        // --- ×‘×—×•×¨×™× ---
        function addOrUpdateStudent() {
            const idx = parseInt(document.getElementById("editIndex").value);
            const student = { firstName: document.getElementById("stFirstName").value, lastName: document.getElementById("stLastName").value, idNum: document.getElementById("stID").value, phone: document.getElementById("stPhone").value, address: document.getElementById("stAddress").value, hebDate: document.getElementById("stHebDate").value, engDate: document.getElementById("stEngDate").value, payment: document.getElementById("stPayment").value, room: document.getElementById("stRoom").value };
            if(!student.firstName || !student.lastName) return alert("×—×•×‘×” ×œ××œ× ×©×");
            if(idx === -1) studentsData.push(student); else { studentsData[idx] = student; document.getElementById("editIndex").value = "-1"; document.getElementById("submitBtn").innerText = "×”×•×¡×£ ×ª×œ××™×“"; }
            renderStudents(); resetStudentForm();
        }
        function editStudent(i) {
            const s = studentsData[i]; document.getElementById("stFirstName").value = s.firstName; document.getElementById("stLastName").value = s.lastName; document.getElementById("stID").value = s.idNum || ""; document.getElementById("stPhone").value = s.phone || ""; document.getElementById("stAddress").value = s.address || ""; document.getElementById("stHebDate").value = s.hebDate || ""; document.getElementById("stEngDate").value = s.engDate || ""; document.getElementById("stPayment").value = s.payment || ""; document.getElementById("stRoom").value = s.room || "";
            document.getElementById("editIndex").value = i; document.getElementById("submitBtn").innerText = "×¢×“×›×Ÿ ×¤×¨×˜×™ ×‘×—×•×¨ âœï¸";
        }
        function resetStudentForm() { document.querySelectorAll("#studentForm input").forEach(i => { if(i.id !== "editIndex") i.value = ""; }); }
        function renderStudents() {
            const list = document.getElementById("students-list");
            list.innerHTML = studentsData.map((s, i) => `<tr><td>${s.firstName} ${s.lastName}</td><td><b>${s.room || '-'}</b></td><td>${s.idNum}</td><td>${s.phone}</td><td>${s.address}</td><td>${s.hebDate}</td><td>${s.engDate}</td><td>â‚ª${s.payment}</td><td><button onclick="editStudent(${i})" style="background:#2196F3; color:white; border:none; padding:5px 8px; cursor:pointer; border-radius:4px;">×¢×¨×•×š</button> <button onclick="removeStudent(${i})" style="background:red; color:white; border:none; padding:5px 8px; cursor:pointer; border-radius:4px;">××—×§</button></td></tr>`).join('');
            updateRoomsUI();
        }
        function updateRoomsUI() {
            const grid = document.getElementById("roomsDisplay"); grid.innerHTML = ""; let occupied = 0;
            for (let r = 1; r <= 7; r++) {
                const roommates = studentsData.filter(s => parseInt(s.room) === r).slice(0, 4); occupied += roommates.length;
                let html = `<div class="room-box"><div class="room-title">×—×“×¨ ${r}</div>`;
                for (let i = 0; i < 4; i++) html += `<div class="bed-item">${roommates[i] ? roommates[i].firstName + ' ' + roommates[i].lastName : ""}</div>`;
                grid.innerHTML += html + `</div>`;
            }
            document.getElementById("occCount").innerText = occupied; document.getElementById("freeCount").innerText = 28 - occupied;
        }
        function removeStudent(i) { if(confirm("×œ××—×•×§ ×ª×œ××™×“ ×–×”?")) { studentsData.splice(i, 1); renderStudents(); } }
        async function saveStudentsToGH() { await saveToGH("students.json", studentsData, "Update Students"); }

        // --- ×©××¨ ×”×¤×•× ×§×¦×™×•×ª ---
        function renderRegistrations() { document.getElementById("registrations-list").innerHTML = allRegistrations.map(r => `<tr><td>${r.date || '---'}</td><td>${r['×©× ×¤×¨×˜×™'] || ''} ${r['×©× ××©×¤×—×”'] || ''}</td><td>${r['×˜×œ×¤×•×Ÿ'] || '---'}</td><td>${r['×¡×˜×˜×•×¡ ××™×©×™'] || '---'}</td><td>${r['×™×©×™×‘×” ×§×•×“××ª'] || '---'}</td><td>${r['××¦×‘ ×¨×•×—× ×™'] || '---'}</td><td><button onclick="alert(JSON.stringify(r, null, 2))">ğŸ‘ï¸</button></td></tr>`).reverse().join(''); }
        function addDonor() { const name = document.getElementById("donorName").value, note = document.getElementById("donorNote").value; if(!name) return; donorsData.push({ name, note }); renderDonors(); }
        function renderDonors() { document.getElementById("donors-list").innerHTML = donorsData.map((d, i) => `<tr><td>${d.name}</td><td>${d.note}</td><td><button onclick="donorsData.splice(${i}, 1); renderDonors();" style="background:red; color:white; border:none; padding:5px;">××—×§</button></td></tr>`).join(''); }
        
        async function updateBoard() {
            const messages = []; 
            for (let i = 1; i <= 5; i++) {
                messages.push({ 
                    title: document.getElementById(`title${i}`).value, // ××•×¡×£ ××ª ×”×›×•×ª×¨×ª
                    text: document.getElementById(`msg${i}`).value, 
                    color: document.getElementById(`clr${i}`).value 
                });
            }
            const data = { 
                patronDay: document.getElementById("patronDayInput").value, 
                patronWeek: document.getElementById("patronWeekInput").value, 
                patronMonth: document.getElementById("patronMonthInput").value, 
                prayers: document.getElementById("prayersInput").value, 
                messagesConfig: messages, 
                lastUpdate: new Date().toLocaleString('he-IL') 
            };
            await saveToGH("data.json", data, "Update Board with Titles");
        }
        
        async function saveDonorsToGH() { await saveToGH("donors.json", donorsData, "Update Donors"); }

        async function fetchFromGH(fileName, callback) {
            const token = document.getElementById("ghToken").value, url = `https://api.github.com/repos/${owner}/${repo}/contents/${fileName}`;
            try {
                const res = await fetch(url, { headers: { "Authorization": `token ${token}` } });
                if (res.ok) { const json = await res.json(); callback(JSON.parse(decodeURIComponent(escape(atob(json.content))))); }
            } catch (e) { console.error(e); }
        }

        async function saveToGH(fileName, data, msg) {
            const token = document.getElementById("ghToken").value; if (!token) return alert("×—×•×‘×” ×˜×•×§×Ÿ!");
            const url = `https://api.github.com/repos/${owner}/${repo}/contents/${fileName}`, status = document.getElementById("globalStatus");
            status.innerText = "××¢×“×›×Ÿ ×©×¨×ª...";
            try {
                let sha = ""; const getFile = await fetch(url, { headers: { "Authorization": `token ${token}` } });
                if (getFile.ok) { const f = await getFile.json(); sha = f.sha; }
                const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));
                const res = await fetch(url, { method: "PUT", headers: { "Authorization": `token ${token}`, "Content-Type": "application/json" }, body: JSON.stringify({ message: msg, content, sha: sha || undefined }) });
                if (res.ok) { status.innerText = "× ×©××¨ ×‘×”×¦×œ×—×”! âœ…"; status.style.color = "green"; }
                else { status.innerText = "×©×’×™××” âŒ"; status.style.color = "red"; }
            } catch (e) { status.innerText = "×©×’×™××” âŒ"; status.style.color = "red"; }
        }
    </script>
</body>
</html>
